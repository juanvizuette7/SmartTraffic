<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>SmartTraffic Dashboard</title>
  <style>
    body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#0f172a;color:#e2e8f0;padding:32px;display:flex;justify-content:center}
    .wrap{width:min(900px,100%);display:grid;gap:18px}
    h1{margin:0;font-size:2rem;text-align:center}
    .status{display:flex;justify-content:center;gap:10px;font-size:.9rem;color:#94a3b8}
    .dot{width:10px;height:10px;border-radius:50%;background:#64748b}
    .stats,.zones{display:grid;gap:14px}
    .stats{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
    .card{background:#1e293b;border-radius:14px;padding:18px;border:1px solid rgba(148,163,184,.25)}
    .label{font-size:.75rem;color:#94a3b8;text-transform:uppercase;letter-spacing:.08em}
    .value{margin-top:6px;font-size:1.8rem;font-weight:600}
    .zone-card{display:grid;gap:10px}
    .badge{width:max-content;padding:6px 12px;border-radius:999px;font-size:.75rem;font-weight:600;color:#0f172a}
    .note{font-size:.85rem;color:#94a3b8;text-align:right}
    .empty{text-align:center;color:#94a3b8;padding:24px;background:#1e293b;border-radius:14px;border:1px dashed rgba(148,163,184,.3)}
  </style>
</head>
<body>
  <main class="wrap">
    <div class="card" style="text-align:center">
      <h1>SmartTraffic Monitor</h1>
      <p style="margin:8px 0 0;color:#94a3b8">Flujo vehicular consolidado por zona</p>
      <div class="status" id="conn"><span class="dot"></span><span id="conn-text">Conectando...</span></div>
    </div>
    <section class="stats">
      <div class="card"><span class="label">Zonas</span><span class="value" id="stat-total">0</span></div>
      <div class="card"><span class="label">Despejada</span><span class="value" id="stat-clear">0</span></div>
      <div class="card"><span class="label">Moderada</span><span class="value" id="stat-moderate">0</span></div>
      <div class="card"><span class="label">Congestionada</span><span class="value" id="stat-congested">0</span></div>
    </section>
    <p class="note" id="last">Esperando datos...</p>
    <section class="zones" id="zones">
      <div class="empty">Aun no llegan mensajes desde Kafka</div>
    </section>
  </main>
  <script>
    const conn=document.getElementById('conn'),connText=document.getElementById('conn-text'),last=document.getElementById('last'),zones=document.getElementById('zones');
    const stats={total:document.getElementById('stat-total'),DESPEJADA:document.getElementById('stat-clear'),MODERADA:document.getElementById('stat-moderate'),CONGESTIONADA:document.getElementById('stat-congested')};
    const colors={DESPEJADA:'#34d399',MODERADA:'#f59e0b',CONGESTIONADA:'#ef4444'};
    function setConn(state,text,color){conn.dataset.state=state;conn.querySelector('.dot').style.background=color;connText.textContent=text;}
    function updateStats(counts){stats.total.textContent=counts.total;stats.DESPEJADA.textContent=counts.DESPEJADA;stats.MODERADA.textContent=counts.MODERADA;stats.CONGESTIONADA.textContent=counts.CONGESTIONADA;}
    function render(data){zones.innerHTML='';const entries=Object.entries(data);if(!entries.length){zones.innerHTML='<div class="empty">Sin datos recientes.</div>';updateStats({total:0,DESPEJADA:0,MODERADA:0,CONGESTIONADA:0});return;}const counts={total:entries.length,DESPEJADA:0,MODERADA:0,CONGESTIONADA:0};entries.sort(([a],[b])=>a.localeCompare(b)).forEach(([zone,state])=>{if(counts[state]!=null)counts[state]+=1;const card=document.createElement('div');card.className='card zone-card';card.innerHTML=`<strong>${zone}</strong><span class="badge" style="background:${colors[state]||'#94a3b8'}">${state||'DESCONOCIDO'}</span><span style="font-size:.85rem;color:#94a3b8">${state==='DESPEJADA'?'Flujo estable':state==='MODERADA'?'Atender intersecciones':state==='CONGESTIONADA'?'Activar desv�os':'Pendiente de datos'}</span>`;zones.appendChild(card);});updateStats(counts);}
    (function connect(){setConn('connecting','Conectando...','#94a3b8');const ws=new WebSocket('ws://localhost:8000/ws');ws.onopen=()=>setConn('online','Conectado','#34d399');ws.onmessage=evt=>{try{render(JSON.parse(evt.data));last.textContent='�ltima actualizaci�n: '+new Date().toLocaleTimeString();}catch(err){console.error(err);}};ws.onclose=()=>{setConn('offline','Reconectando...','#f97316');setTimeout(connect,2000);};ws.onerror=()=>ws.close();})();
  </script>
</body>
</html>
